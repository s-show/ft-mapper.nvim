# ft-mapper.nvim

`f`、`F`、`t`、`T` モーションを拡張し、1つのキー入力で複数の文字バリエーションを検索できるようにする Neovim プラグインです。半角・全角文字が混在する多言語環境での作業に最適です。

## ✨ 特徴

- **複数文字検索**: 1つのキー入力で複数の文字バリエーションを検索（ex: `f,` で `,` に加えて `、` や `，` にジャンプできる）
- **全角・半角対応**: 日本語、中国語などの全角文字をシームレスに処理
- **標準動作の維持**: マッピングされていない文字は通常の Vim の動作にフォールバック
- **繰り返し対応**: `;` と `,` による検索の繰り返しに対応
- **カウント対応**: カウントプレフィックス（例：`3f,`）に対応
- **全モード対応**: ノーマル、ビジュアル、オペレータ待機モードで動作

## 📦 インストール

### [lazy.nvim](https://github.com/folke/lazy.nvim) を使用する場合

[lazy.nvim](https://github.com/folke/lazy.nvim) を使用する場合の設定は以下のとおりです。デフォルトマッピングは用意していませんので、`mappings` は必ず設定してください。 

```lua
{
  "your-username/ft-mapper.nvim",
  config = function()
    require("ft-mapper").setup({
      mappings = {
        { ",", "、", "，" },
        { ".", "。", "．" },
        { ":", "：" },
        { "[", "「", "『", "【", "［" },
        { "]", "」", "』", "】", "］" },
        -- 必要に応じてマッピングを追加
      }
    })
  end
}
```

## ⚙️ 設定

### 設定項目

- `mappings (string[][])`
    - `f` や `t` と組み合わせるキーと、そのキーを使って検索したいキーの組み合わせを設定します。
    - 例: { ",", "、", "，" }
    - 最初の要素: `f,` の `,` のように、`f` や `t` と組み合わせて入力する文字
    - 残りの要素: `f,` とタイプした時に検索する文字
- `debug (boolean)`
    - トラブルシューティングのためにデバッグ出力を有効化するための設定です。通常は `false` にしてください。

```lua
require("ft-mapper").setup({
  mappings = {
    -- これは日本語を念頭に置いた設定です。
    { ',', '、', '，' },
    { '.', '。', '．' },
    { ":", "：" },
    { ";", "；" },
    { "!", "！" },
    { "?", "？" },
    { "(", "（" },
    { ")", "）" },
    { "[", "「", "『", "【", "［" },
    { "]", "」", "』", "】", "］" },
    { "'", "'", "'" },
    { '"', "“", "”", "゛" },
    { '<', "＜", "«" },
    { '>', "＞", "»" },
    { "-", "ー", "―", "—", "–" },
    { " ", "　" }, -- 半角・全角スペース
  },
  -- デバッグ出力を有効化（オプション）
  debug = false
})
```

## 🚀 使い方

設定後は、通常通り `f`、`F`、`t`、`T` モーションを使用するだけです：

- `f,` - 次の `,`、`、`、`，` にジャンプ
- `F,` - 前の `,`、`、`、`，` にジャンプ
- `t,` - 次の `,`、`、`、`，` の直前にジャンプ
- `T,` - 前の `,`、`、`、`，` の直後にジャンプ

繰り返しモーションも使えます：
- `;` - 同じ方向に最後の検索を繰り返す
- `,` - 逆方向に最後の検索を繰り返す

カウントプレフィックスにも対応します：
- `3f,` - 3番目の `,`、`、`、`，` にジャンプ

## 🔍 使用例

### 日本語テキスト
```
これは、テストです。次の文、そして最後の文。
```
- 先頭から `f,` でいずれかのコンマにジャンプ
- 末尾から `F。` でいずれかの句点に後方ジャンプ

### 多言語混在ドキュメント
```
Hello, world! こんにちは、世界！
```
- `f!` で `!` と `！` の両方を検索
- `f,` で `,` と `、` の両方を検索

### デモ動画

[demo_without_operator.webm](https://github.com/user-attachments/assets/3d070a72-ea37-41a2-b72f-4b805f999c14)

[demo_with_operator.webm](https://github.com/user-attachments/assets/081f6e68-33d8-4b88-9575-9d6b6501f7a0)

## 🛠️ 高度な機能

### デバッグモード

マッピングのトラブルシューティングのためにデバッグ出力を有効化：

```lua
require("ft-mapper").setup({
  mappings = { --[[ マッピング設定 ]] },
  debug = true
})
```

### 現在の設定を確認

```vim
:lua require("ft-mapper").show_config()
" or
:= require("ft-mapper").show_config()
```

## 📋 動作環境

- Neovim 0.7.0 以降
- 外部依存関係なし

## 📄 ライセンス

このプロジェクトは MIT ライセンスの下でライセンスされています。詳細は [LICENSE](LICENSE) ファイルを参照してください。

## このプラグインの元となったプラグイン

このプラグインは、私が日常的に使っていた [juro106/ftjpn](https://github.com/juro106/ftjpn) を Lua で書き直した上で、その機能を拡張したいと思って作ったものです。

日本語の文書の編集効率をアップさせる [juro106/ftjpn](https://github.com/juro106/ftjpn) を作成されたことに感謝します。

## よくある質問

### Q: なぜこのプラグインが必要なのですか？

A: 日本語と英語が混在する文書では、半角（,）と全角（、）の句読点が混在することがよくあります。通常の `f,` では半角コンマしか検索できませんが、このプラグインを使えば両方を検索できます。

### Q: カスタムマッピングを追加できますか？

A: `mappings` テーブルに新しいエントリを追加すれば OK です。最初の要素が入力文字、残りが検索対象文字です。
